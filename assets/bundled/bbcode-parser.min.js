/* Source code in bbcode-src */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).bbcodeParser={})}(this,(function(t){"use strict";const e="\n",n="\t",s="=",r='"',o=" ",a="[",i="]",c="/",l="\\";function u(t){return"object"==typeof t&&null!==t&&"tag"in t}function d(t){return"string"==typeof t}function g(t){return t===e}function h(t,e,n){return Object.keys(t).reduce(((n,s)=>e(n,s,t)),n)}function p(t){return u(t)&&Array.isArray(t.content)?t.content.reduce(((t,e)=>t+p(e)),0):d(t)?String(t).length:0}function f(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/(javascript|data|vbscript):/gi,"$1%3A")}function b(t,e){switch(typeof e){case"boolean":return e?`${t}`:"";case"number":return`${t}="${e}"`;case"string":return`${t}="${f(e)}"`;case"object":return`${t}="${f(JSON.stringify(e))}"`;default:return""}}function m(t){return null==t?"":h(t,((t,e,n)=>[...t,b(e,n[e])]),[""]).join(" ")}const w=(t,e)=>{const n=h(e||{},((t,e,n)=>n[e]===e?n[e]:null),null);if(n){const s=b(t,n),r={...e};delete r[String(n)];return`${s}${m(r)}`}return`${t}${m(e)}`};class y{attr(t,e){return void 0!==e&&(this.attrs[t]=e),this.attrs[t]}append(t){return function(t,e){Array.isArray(t.content)&&t.content.push(e)}(this,t)}setStart(t){this.start=t}setEnd(t){this.end=t}get length(){return p(this)}toTagStart({openTag:t=a,closeTag:e=i}={}){return`${t}${w(String(this.tag),this.attrs)}${e}`}toTagEnd({openTag:t=a,closeTag:e=i}={}){return`${t}${c}${this.tag}${e}`}toTagNode(){const t=new y(String(this.tag).toLowerCase(),this.attrs,this.content);return this.start&&t.setStart(this.start),this.end&&t.setEnd(this.end),t}toString({openTag:t=a,closeTag:e=i}={}){const n=this.content?((t,e,n)=>{const s=t=>u(t)?t.toString({openTag:e,closeTag:n}):String(t);return Array.isArray(t)?t.reduce(((t,e)=>null!==e?t+s(e):t),""):t?s(t):null})(this.content,t,e):"",s=this.toTagStart({openTag:t,closeTag:e});return null===this.content||Array.isArray(this.content)&&0===this.content.length?s:`${s}${n}${this.toTagEnd({openTag:t,closeTag:e})}`}static create(t,e={},n=null,s){const r=new y(t,e,n);return s&&r.setStart(s),r}static isOf(t,e){return t.tag===e}constructor(t,e,n){this.tag=t,this.attrs=e,this.content=n}}const v="t",x=t=>t&&void 0!==t.v?t.v:"",$=t=>x(t).charCodeAt(0)===c.charCodeAt(0);class k{get type(){return this[v]}isEmpty(){return 0===this[v]||isNaN(this[v])}isText(){return!(!(t=this)||void 0===t[v]||5!==t[v]&&6!==t[v]&&1!==t[v]);var t}isTag(){return!(!(t=this)||void 0===t[v])&&2===t[v];var t}isAttrName(){return!(!(t=this)||void 0===t[v])&&3===t[v];var t}isAttrValue(){return!(!(t=this)||void 0===t[v])&&4===t[v];var t}isStart(){return!$(this)}isEnd(){return $(this)}getName(){return(t=>{const e=x(t);return $(t)?e.slice(1):e})(this)}getValue(){return x(this)}getLine(){return(t=this)&&t.l||0;var t}getColumn(){return(t=this)&&t.r||0;var t}getStart(){return(t=this)&&t.s||0;var t}getEnd(){return(t=this)&&t.e||0;var t}toString({openTag:t=a,closeTag:e=i}={}){return((t,e=a,n=i)=>{let s=e;return s+=x(t),s+=n,s})(this,t,e)}constructor(t,e,n=0,s=0,r=0,o=0){this.l=n,this.r=s,this[v]=t||0,this.v=String(e),this.s=r,this.e=o}}class T{skip(t=1,e){this.c.pos+=t,this.o&&this.o.onSkip&&!e&&this.o.onSkip()}hasNext(){return this.c.len>this.c.pos}getCurr(){return void 0===this.s[this.c.pos]?"":this.s[this.c.pos]}getPos(){return this.c.pos}getLength(){return this.c.len}getRest(){return this.s.substring(this.c.pos)}getNext(){const t=this.c.pos+1;return t<=this.s.length-1?this.s[t]:null}getPrev(){const t=this.c.pos-1;return void 0===this.s[t]?null:this.s[t]}isLast(){return this.c.pos===this.c.len}includes(t){return this.s.indexOf(t,this.c.pos)>=0}grabWhile(t,e){let n=0;if(this.hasNext())for(n=this.c.pos;this.hasNext()&&t(this.getCurr());)this.skip(1,e);return this.s.substring(n,this.c.pos)}grabN(t=0){return this.s.substring(this.c.pos,this.c.pos+t)}substrUntilChar(t){const{pos:e}=this.c,n=this.s.indexOf(t,e);return n>=0?this.s.substring(e,n):""}constructor(t,e={}){this.s=t,this.c={pos:0,len:t.length},this.o=e}}const A=(t,e)=>new T(t,e);const C=[o,n],S=[s,o,n],_=t=>C.indexOf(t)>=0,j=t=>t===l,L=t=>((t,e)=>{for(;t.charAt(0)===e;)t=t.substring(1);for(;t.charAt(t.length-1)===e;)t=t.substring(0,t.length-1);return t})(t,r).replace(l+r,r);function O(t,u={}){let d=0,g=0,h=0,p=-1,f=0,b=0,m="";const w=new Array(Math.floor(t.length)),y=u.openTag||a,v=u.closeTag||i,x=!!u.enableEscapeTags,$=(u.contextFreeTags||[]).filter(Boolean).map((t=>t.toLowerCase())),T=u.caseFreeTags||!1,C=new Map,O=u.onToken||(()=>{}),E=[v,y,r,l,o,n,s,e,"!"],N=[y,o,n,e],W=t=>-1===N.indexOf(t),I=()=>{h++},U=(t,e)=>{""!==m&&e&&(m=""),""===m&&$.includes(t.toLowerCase())&&(m=t)},V=A(t,{onSkip:I});function q(t,e,n,s){const r=function(t,e,n=0,s=0,r=0,o=0){return new k(t,e,n,s,r,o)}(t,e,d,g,n,s);O(r),g=h,p+=1,w[p]=r}function D(t,e,n){if(1===b){const e=t=>!(t===s||_(t)),n=t.grabWhile(e),r=t.isLast(),o=t.getCurr()!==s;return t.skip(),r||o?q(4,L(n)):q(3,n),r?0:o?1:2}if(2===b){let n=!1;const o=o=>{const a=o===r,i=t.getPrev(),c=t.getNext(),u=i===l,d=c===s,g=_(o),h=c&&_(c);return!(!n||!(t=>S.indexOf(t)>=0)(o))||!!(!a||u||(n=!n,n||d||h))&&(!!e||!g)},a=t.grabWhile(o);return t.skip(),q(4,L(a)),t.getPrev()===r&&g++,t.isLast()?0:1}const o=n+t.getPos()-1,a=t.grabWhile((e=>!(e===s||_(e)||t.isLast())));if(q(2,a,o,n+t.getLength()+1),U(a),t.skip(),g++,e)return 2;return t.includes(s)?1:2}function G(){const t=V.getCurr(),e=V.getNext();V.skip();const n=V.substrUntilChar(v),r=0===n.length||n.indexOf(y)>=0;if(e&&(o=e,E.indexOf(o)>=0)||r||V.isLast())return q(1,t),0;var o;const a=-1===n.indexOf(s),i=n[0]===c;if(a||i){const t=V.getPos()-1,e=V.grabWhile((t=>t!==v)),n=t+e.length+2;return V.skip(),q(2,e,t,n),U(e,i),0}return 2}function z(){const t=V.getPos(),e=V.grabWhile((t=>t!==v),!0),n=A(e,{onSkip:I}),s=n.includes(o);for(b=0;n.hasNext();)b=D(n,!s,t);return V.skip(),0}function P(){if(V.getCurr()===e)return q(6,V.getCurr()),V.skip(),h=0,g=0,d++,0;if(_(V.getCurr())){return q(5,V.grabWhile(_)),0}if(V.getCurr()===y){if(m){const t=y.length+1+m.length,e=`${y}${c}${m}`;if(V.grabN(t)===e)return 1}else if(V.includes(v))return 1;return q(1,V.getCurr()),V.skip(),g++,0}if(x){if(j(V.getCurr())){const t=V.getCurr(),e=V.getNext();return V.skip(),e&&(t=>t===y||t===v||t===l)(e)?(V.skip(),q(1,e),0):(q(1,t),0)}const t=t=>W(t)&&!j(t);return q(1,V.grabWhile(t)),0}return q(1,V.grabWhile(W)),0}return{tokenize:function(){for(f=0;V.hasNext();)switch(f){case 1:f=G();break;case 2:f=z();break;default:f=P()}return w.length=p+1,w},isTokenNested:function(e){const n=y+c+e;if(C.has(n))return!!C.get(n);{const e=T?t.toLowerCase().indexOf(n.toLowerCase())>-1:t.indexOf(n)>-1;return C.set(n,e),e}}}}class E{last(){return Array.isArray(this.n)&&this.n.length>0&&void 0!==this.n[this.n.length-1]?this.n[this.n.length-1]:null}flush(){return!!this.n.length&&this.n.pop()}push(t){this.n.push(t)}toArray(){return this.n}constructor(){this.n=[]}}const N=()=>new E;function W(t,e={}){const n=e,s=n.openTag||a,r=n.closeTag||i,o=(n.onlyAllowTags||[]).filter(Boolean).map((t=>t.toLowerCase())),c=n.caseFreeTags||!1;let l=null;const d=N(),g=N(),h=N(),p=N(),f=new Set;function b(t){return Boolean(f.has(c?t.toLowerCase():t))}function m(){h.flush()&&p.flush()}function w(){const t=g.last();return t&&u(t)?t.content:d.toArray()}function v(t,e,n=!0){Array.isArray(t)&&void 0!==e&&(t.push(e.toTagStart({openTag:s,closeTag:r})),Array.isArray(e.content)&&e.content.length&&(e.content.forEach((e=>{t.push(e)})),n&&t.push(e.toTagEnd({openTag:s,closeTag:r}))))}function x(t,e){var n;Array.isArray(t)&&void 0!==e&&(u(e)?(n=e.tag,!o.length||o.indexOf(n.toLowerCase())>=0?t.push(e.toTagNode()):v(t,e)):t.push(e))}function $(t){m();const e=y.create(t.getValue(),{},[],{from:t.getStart(),to:t.getEnd()}),n=function(t){const e=t.getValue(),n=c?e.toLowerCase():e,{isTokenNested:s}=l||{};return!f.has(n)&&s&&s(n)?(f.add(n),!0):f.has(n)}(t);if(h.push(e),n)g.push(e);else{x(w(),e)}}function k(t){t.isStart()&&$(t),t.isEnd()&&function(t){const e=t.getValue().slice(1),o=g.flush();if(m(),o){const e=w();u(o)&&o.setEnd({from:t.getStart(),to:t.getEnd()}),x(e,o)}else if(b(e)){if("function"==typeof n.onError){const e=t.getValue(),s=t.getLine(),r=t.getColumn();n.onError({tagName:e,lineNumber:s,columnNumber:r})}}else x(w(),t.toString({openTag:s,closeTag:r}))}(t)}const T=e.createTokenizer?e.createTokenizer:O;l=T(t,{onToken:function(t){t.isTag()?k(t):function(t){const e=h.last(),n=t.getValue(),o=b(t.toString()),a=w();if(null!==e)if(t.isAttrName()){p.push(n);const t=p.last();t&&e.attr(t,"")}else if(t.isAttrValue()){const t=p.last();t?(e.attr(t,n),p.flush()):e.attr(n,n)}else t.isText()?o?e.append(n):x(a,n):t.isTag()&&x(a,t.toString({openTag:s,closeTag:r}));else t.isText()?x(a,n):t.isTag()&&x(a,t.toString({openTag:s,closeTag:r}))}(t)},openTag:s,closeTag:r,onlyAllowTags:n.onlyAllowTags,contextFreeTags:n.contextFreeTags,caseFreeTags:n.caseFreeTags,enableEscapeTags:n.enableEscapeTags}),l.tokenize();const A=g.flush();return null!==A&&A&&u(A)&&b(A.tag)&&v(w(),A,!1),d.toArray()}const I=t=>"object"==typeof t&&null!==t;function U(t,e){const n=t;if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=U(e(n[t]),e);else I(n)&&"content"in n&&U(n.content,e);return n}function V(t,e){return typeof t==typeof e&&(I(t)&&null!==t?Array.isArray(t)?t.every((t=>[].some.call(e,(e=>V(t,e))))):!(!I(t)||!I(e))&&Object.keys(t).every((n=>{const s=e[n],r=t[n];return I(r)&&I(s)?V(r,s):"boolean"==typeof r?r!==(null===s):s===r})):t===e)}function q(t,e){const n=t;return n.messages=[...n.messages||[]],n.options={...e,...n.options},n.walk=function(t){return U(this,t)},n.match=function(t,e){return function(t,e,n){return Array.isArray(e)?U(t,(t=>{for(let s=0;s<e.length;s++)if(V(e[s],t))return n(t);return t})):U(t,(t=>V(e,t)?n(t):t))}(this,t,e)},n}function D(t,e){const{stripTags:n=!1}=e||{};if(null==t)return"";if("string"==typeof t||"number"==typeof t)return String(t);if(Array.isArray(t))return G(t,e);if(u(t)){if(n)return G(t.content,e);const s=m(t.attrs);return null===t.content?"<"+t.tag+s+"/>":"<"+t.tag+s+">"+G(t.content,e)+"</"+t.tag+">"}return""}function G(t,e){return t&&Array.isArray(t)?t.reduce(((t,n)=>t+D(n,e)),""):t?D(t,e):""}const z=(t,e,n=[])=>({tag:t,attrs:e,content:n,gen:!0}),P=(t,e)=>{const n=Object.keys(t.attrs).join(" "),s=Object.values(t.attrs).join(" ");if(n!==s)return t.attrs;if(!e||!t.start)return{_default:s};const r=e.substring(t.start.from,t.start.to);if(!r.includes("="))return t.attrs;const o=r.split("=");if(2!==o.length)return t.attrs;let a=o[1].slice(0,-1).trim();return a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1)),{_default:a}},M=(t,e)=>{if(t.start)return e.substring(t.start.from,t.start.to);if(!t.attrs)return`[${t.tag}]`;const n=P(t,e);return n._default?`[${t.tag}=${n._default}]`:t.toTagStart()},F=(t,e)=>t.end?e.substring(t.end.from,t.end.to):t.toTagEnd(),B=(t,e,n)=>{const s=t.substring(n||0).search(e);return s>=0?s+(n||0):s},R="\x3c!-- bbcode injected newlines --\x3e\n\n",J="\n\n\x3c!-- bbcode pre injected newlines --\x3e",Z="\x3c!-- bbcode injected newlines --\x3e",H=new RegExp(`^${/(http|ftp|https|upload):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])/.source}|${/\!?\[.*\]\((http|ftp|https|upload):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])\)/.source}$`),K=/((\n|^)(?<fence>```+|~~~+)(?<fenceInfo>.*\n))|(?<bbcode>\[(?<bbcodeTag>i?code|plain)(=.*)?\])|(?<backtick>(?<tickStart>`{1,2})(.*)(?<tickEnd>\k<tickStart>))/im,Q=/^(\|[^\n]+\|\r?\n)((?:\| ?:?[-]+:? ?)+\|)(\n(?:\|[^\n]+\|\r?\n?)*)?$/m;function X(){let t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}))}const Y=t=>"object"==typeof t,tt=t=>"string"==typeof t,et=(t,e=!1)=>{const n=t;if(Array.isArray(n)){nt(n),n.some(tt)&&(n.unshift(R),n.push(R));for(let t=0;t<n.length;t++){const s=et(n[t],e);Array.isArray(s)?(n.splice(t,1,...s),t+=s.length-1):n[t]=s}}else{if(n&&Y(n)&&n.content)return n.isWhitespaceSensitive||(n.disableLineBreakConversion&&(e=!0),et(n.content,e)),n.tag?n:n.content;if(tt(n)&&H.test(n.trim()))return[n,J]}return tt(n)&&g(n)?e?["\n",R]:[{tag:"br",content:null},R]:n},nt=t=>{let e=t.findLastIndex((t=>tt(t)&&!g(t)))+1;for(let n=e-1;n>=0;n--)tt(t[n])&&!g(t[n])||(g(t[n])||Y(t[n]))&&(n!==e-1&&t.splice(n+1,e-n-1,t.slice(n+1,e).join("")),e=n);0!==e&&t.splice(0,e,t.slice(0,e).join(""))},st=t=>{const e=t;if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=st(e[t]);Array.isArray(n)?(e.splice(t,1,...n),t+=n.length-1):e[t]=n}else e&&"object"==typeof e&&e.content&&st(e.content);if(d(e)&&e.length>1&&" "===e[0]){let t=e.length;return[String.fromCharCode(160).repeat(t)]}return e},rt=/\n{2,}/gm,ot=t=>t.walk((t=>(u(t)&&t.attrs&&Object.keys(t.attrs).forEach((e=>{"string"==typeof t.attrs[e]&&(t.attrs[e]=t.attrs[e].replace(rt,"\n"))})),t)));function at(t,e,n,s){return e.walk((e=>{if(u(e)){const r=e.tag,o=t[r];if("function"==typeof o)return o(e,n,s)}return e}))}const it=Symbol("slide-title-open"),ct=Symbol("slide-title-close"),lt=Symbol("slide-close"),ut=/(?<slideTitleOpen>\{slide=)|(?<slideTitleClose>\})|(?<slideClose>\{\/slide\})/i;function dt(t){switch(t){case it:return"{slide=";case ct:return"}";case lt:return"{/slide}";default:return t}}const gt={accordion:(t,e)=>{const n=X(),s=function(t){t=[...t];const e=[];for(;t.length>0;){const n=t[0];if(u(n)){e.push(t.shift());continue}const s=B(n,ut);if(-1===s){e.push(t.shift());continue}const r=n.match(ut),o=n.slice(0,s),a=n.slice(s+r[0].length);o.length&&e.push(o),r.groups.slideTitleOpen&&e.push(it),r.groups.slideTitleClose&&e.push(ct),r.groups.slideClose&&e.push(lt),a.length?t[0]=a:t.shift()}return e}(t.content),r=function(t){const e=[];let n=null,s=null;for(const r of t)if(r===it&&null===s)n=y.create("slide"),n.content=[],n.customTitle=[],s=it;else{if(r===ct&&s===it){s=ct;continue}r===lt&&n&&s===ct?(e.push(n),n=null,s=null):n?s===it?n.customTitle.push(dt(r)):n.content.push(dt(r)):e.push(dt(r))}return e}(s),o=r.filter((t=>u(t)&&"slide"===t.tag)).map((t=>(t.isValid=!0,t.groupId=n,t)));if(!o.length)return[M(t,e.data.raw),...t.content,F(t,e.data.raw)];const a=P(t,e.data.raw);if(a._default){const t=a._default.split("|").map((t=>t.trim())),e=t.filter((t=>["bright","bcenter","bleft","fleft","fright"].includes(t))).pop();e&&(a.align??=e),(t.some((t=>t.endsWith("px")))||t.some((t=>t.endsWith("%"))))&&(a.width??=t.find((t=>t.endsWith("px")||t.endsWith("%"))))}let i=a.align?.toLowerCase()||"",c="";return(a.width?.endsWith("px")||a.width?.endsWith("%"))&&(c=`width: ${a.width};`),z("div",{class:"bb-accordion "+i,"data-group-id":n,style:c},o)},slide:(t,e)=>{if(!t.isValid)return[M(t,e.data.raw),...t.content,F(t,e.data.raw)];const n=P(t,e.data.raw);let s=[n.title||n._default||"Slide"],r=!!n.open||!1,o=n.left?"left":n.right?"right":n.center?"center":"left";if(t.customTitle?.length){s=t.customTitle;const e=s.filter((t=>"string"==typeof t)).join("").toLowerCase().split("|").map((t=>t.trim()));e.includes("open")&&(r=!0),e.includes("right")&&(o="right"),e.includes("center")&&(o="center"),e.includes("left")&&(o="left"),s=s.map((t=>(d(t)&&(t=t.replace(/\|(open|right|center|left)/gi,"")),t)))}return[z("details",{class:"bb-slide",open:r},[z("summary",{class:"bb-slide-title",style:`text-align: ${o}; ${n.style||""}`},s),z("div",{class:"bb-slide-content"},t.content)])]}},ht={left:t=>z("div",{class:"bb-left"},t.content),center:t=>z("div",{class:"bb-center"},t.content),right:t=>z("div",{class:"bb-right"},t.content)},pt={a:(t,e)=>{const n=P(t,e.data.raw)._default||"";return z("a",{id:`user-anchor-${n.trim()}`,name:`user-anchor-${n.trim()}`},t.content)},goto:(t,e)=>{const n=P(t,e.data.raw)._default||"";return z("a",{href:`#user-anchor-${n.trim()}`},t.content)}},ft=["arial","book antiqua","courier new","georgia","tahoma","times new roman","trebuchet ms","verdana"],bt={thin:"100",extralight:"200",light:"300",regular:"400",medium:"500",semibold:"600",bold:"700",extrabold:"800",black:"900"},mt=["ital","opsz","slnt","wdth","wght"],wt=/(?<named_weight>[a-zA-Z]*)?\s?(?<weight>[0-9]*)?\s?(?<italic>italic)?/;const yt=z("div",{class:"bb-email-header"},""),vt=z("div",{class:"bb-email-footer"},z("div",{class:"bb-email-button"},"")),xt={row:t=>z("div",{class:"bb-row"},t.content),column:(t,e)=>{const n=P(t,e.data.raw)._default||"8",s=n.startsWith("span")?`column-width-${n}`:`column-width-span${n}`;return z("div",{class:"bb-column","data-span":s},t.content)}},$t=["init","click","change","input","dblclick","mouseenter","mouseleave","scroll"];const kt=["me","them","right","left"],Tt={textmessage:(t,e)=>{const n=P(t,e.data.raw)._default||"Recipient",s=""!==n.trim()?n:"Recipient";return z("div",{class:"bb-textmessage"},[z("div",{class:"bb-textmessage-name"},s),z("div",{class:"bb-textmessage-overflow"},[z("div",{class:"bb-textmessage-content"},t.content)])])},message:(t,e)=>{let n=P(t,e.data.raw)._default.toLowerCase();kt.includes(n)&&"right"!==n||(n="me"),"left"===n&&(n="them");return z("div",{class:"me"===n?"bb-message-me":"bb-message-them"},[z("div",{class:"bb-message-content"},t.content)])}},At={...gt,...ht,...pt,animation:(t,e)=>{e.data.previewing||e.data.commonGUID||(e.data.commonGUID="post-"+Math.random().toString(36).substring(2,7));const n=e.data.previewing?"preview":e.data.commonGUID,s=P(t,e.data.raw)?._default||"",r=t.content.filter((t=>u(t)&&"keyframe"===t.tag)).map((t=>{t.isValid=!0;const n=P(t,e.data.raw)._default||"";t.ident=n+(n.match(/^\d+$/)?"%":"");const s=t.content.filter(d).join("").replaceAll(/[\[\]\{\}]/g,"");return t.formatted=`${t.ident}{ ${s} }`,t})),o=`@keyframes ${n}${s} { ${r.map((t=>t.formatted)).join("\n")} }`;return e.data.styles.push(o),[]},bg:(t,e)=>{const n=P(t,e.data.raw)._default;return z("div",{style:`background-color: ${n};`,class:"bb-background"},t.content)},block:(t,e)=>{const n="block",s=(P(t,e.data.raw)._default||n).toLowerCase(),r=["block","dice","dice10","setting","warning","storyteller","announcement","important","question","encounter","information","character","treasure"].includes(s)?s:n;return z("table",{class:"bb-block","data-bb-block":r},[z("tbody",[z("tr",[z("td",{class:"bb-block-icon"}),z("td",{class:"bb-block-content"},t.content)])])])},blockquote:(t,e)=>{const n=P(t,e.data.raw)._default||"";return z("div",{class:"bb-blockquote"},[z("div",{class:"bb-blockquote-left"}),z("div",{class:"bb-blockquote-content"},[t.content,z("div",{class:"bb-blockquote-speaker"},""!==n?`- ${n}`:"")]),z("div",{class:"bb-blockquote-right"})])},border:(t,e)=>{const n=P(t,e.data.raw)._default;return z("div",{style:`border: ${n};`,class:"bb-border"},t.content)},br:()=>z("br",{},null),centerblock:(t,e)=>{const n=P(t,e.data.raw)._default||"50";return z("div",{style:`margin: 0 auto; width: ${n}%`},t.content)},check:(t,e)=>{const n=P(t,e.data.raw)._default||"dot";return z("div",{class:"bb-check","data-type":n},t.content)},class:(t,e)=>{const n=P(t),s=n.name||n._default;e.data.previewing||e.data.commonGUID||(e.data.commonGUID="post-"+Math.random().toString(36).substring(2,7));const r=e.data.previewing?"preview":e.data.commonGUID,o=s+"__"+r,a=t.content.filter(d).map((t=>t.replaceAll("{post_id}",r).replaceAll(/[\[\]\{\}]/g,"")));let i="";const c=[];return["hover","focus","active","focus-within","focus-visible"].includes(n.state?.toLowerCase())&&(i=":"+n.state.toLowerCase()),n.selector&&(i=n.selector.replace(/[,{}\\\n]/g,"")),n.minWidth?.match(/^[0-9]+[a-z]+$/)&&c.push(`(min-width: ${n.minWidth})`),n.maxWidth?.match(/^[0-9]+[a-z]+$/)&&c.push(`(max-width: ${n.maxWidth})`),a.unshift(`.${o}${i} {`),a.push("}"),c.length&&(a.unshift(`@media ${c.join(" and ")} {`),a.push("}")),e.data.styles.push(a.join("")),[]},code:t=>({isWhitespaceSensitive:!0,content:["```"+(P(t)._default||"bbcode")+"\n",t.content,"\n```\n"]}),color:t=>{const e=P(t)._default||"";return""===e.trim()?t.content:z("span",{style:`color: ${e}`},t.content)},comment:t=>z("span",{class:"hidden"},t.content),div:(t,e)=>{if(t.gen)return t;const n=P(t,e.data.raw),s=n.style||n._default,r=n.class;if(!r?.trim())return z("div",{style:s},t.content);e.data.previewing||e.data.commonGUID||(e.data.commonGUID="post-"+Math.random().toString(36).substring(2,7));const o=e.data.previewing?"preview":e.data.commonGUID,a=r.split(" ").map((t=>t+"__"+o)).join(" ");return z("div",{class:a,style:s},t.content)},divide:t=>{const e=(P(t)._default||"").toLowerCase();return z("span",{class:"bb-divide","data-type":e},t.content)},fieldset:(t,e)=>{const n=P(t,e.data.raw)._default||"";return z("fieldset",{class:"bb-fieldset"},[z("legend",{class:"bb-fieldset-legend"},n),z("div",{class:"bb-fieldset"},t.content)])},fa:t=>{const e=t.attrs;let n=e.style||"";return n+=e["primary-color"]?`--fa-primary-color: ${e["primary-color"]};`:"",n+=e["secondary-color"]?`--fa-secondary-color: ${e["secondary-color"]};`:"",n+=e["primary-opacity"]?`--fa-primary-opacity: ${e["primary-opacity"]};`:"",n+=e["secondary-opacity"]?`--fa-secondary-opacity: ${e["secondary-opacity"]};`:"",n+=e["rotate-angle"]?`--fa-rotate-angle: ${e["rotate-angle"]};`:"",z("i",{"data-bbcode-fa":null},[z("i",{class:(t.content||[]).join(""),style:n,"data-fa-transform":e["fa-transform"]||""},[])])},font:(t,e)=>{const n=P(t,e.data.raw),s=n?._default||n?.family||n?.name;if(!s||""===s.trim())return t.content;if(ft.includes(s.trim().toLowerCase()))return z("span",{style:`font-family: '${s}'`},t.content);const r=(t=>{let e={ital:0,wght:400};if(t?.style){const n=t.style.trim().toLowerCase(),s=wt.exec(n).groups||{};s?.italic&&(e.ital=1);const r=s.weight;r&&r>=0&&r<=900?e.wght=r:Object.keys(bt).includes(s.named_weight||"")&&(e.wght=bt[s.named_weight]),e={...e,...Object.fromEntries(Object.entries(t).filter((([t])=>mt.includes(t))))}}return e})(n),o=((t,e)=>(t=t.replaceAll(" ","+"),e=Object.keys(e).sort().reduce(((t,n)=>(t[n]=e[n],t)),{}),"https://fonts.googleapis.com/css2?family="+t+":"+Object.keys(e).join(",")+"@"+Object.values(e).join(",")))(s,r);e.data.fonts.add(o);const a=1===r.ital?"italic":"normal",i=Object.entries(r).filter((([t])=>"wght"!==t&&"ital"!==t));let c="";return i.length&&(c="font-variation-settings: "+i.map((([t,e])=>`'${t}' ${e}`)).join(", ")+";"),z("span",{style:`font-family: '${s}'; font-weight: ${r.wght}; font-style: ${a}; ${c}`,"data-font":o},t.content)},h:t=>z("h1",{},t.content),h1:t=>z("h1",{},t.content),h2:t=>z("h2",{},t.content),h3:t=>z("h3",{},t.content),h4:t=>z("h4",{},t.content),h5:t=>z("h5",{},t.content),h6:t=>z("h6",{},t.content),heightrestrict:t=>{const e=function(t){const e=t&&""!==t.trim()?t.replace(/[^\d.]/g,""):0;return e&&e>=0&&e<=700?e:0===e?0:700}(P(t)._default).toString();return z("div","0"===e?{class:"bb-height-restrict"}:{class:"bb-height-restrict",style:`height: ${e}px;`},t.content)},highlight:t=>z("span",{class:"bb-highlight"},t.content),icode:t=>({isWhitespaceSensitive:!0,content:["`",t.content,"`"]}),imagefloat:t=>{const e=P(t)._default||"";return z("div",{class:`bb-float-${e}`},t.content)},inlinespoiler:t=>z("span",{class:"bb-inline-spoiler"},t.content),justify:t=>z("div",{class:"bb-justify"},t.content),keyframe:(t,e)=>t.isValid?[]:[M(t,e.data.raw),...t.content,F(t,e.data.raw)],mail:t=>{const e=t.attrs;let n={mailOption:(e.type||"send").toLowerCase(),person:e.person||"Unknown",subject:e.subject||"Empty"};return z("div",{class:"bb-email","data-bb-email":n.mailOption},[yt,(o=n.person,z("div",{class:"bb-email-address"},o)),(r=n.subject,z("div",{class:"bb-email-subject"},r)),(s=t.content,z("div",{class:"bb-email-content"},s)),vt]);var s,r,o},newspaper:t=>z("div",{class:"bb-newspaper"},t.content),nobr:t=>({disableLineBreakConversion:!0,content:t.content}),note:t=>z("div",{class:"bb-note"},[z("div",{class:"bb-note-tape"},""),z("div",{class:"bb-note-content"},[t.content,z("div",{class:"bb-note-footer"},"")])]),ooc:t=>z("div",{class:"bb-ooc"},t.content),pindent:t=>z("span",{class:"bb-pindent"},t.content),plain:t=>t.content,print:t=>{const e="print",n=(P(t)._default||e).toLowerCase(),s=["print","line","graph","parchment"].includes(n)?n:e;return z("div",{class:s===e?"bb-print":`bb-print-${s}`},t.content)},progress:t=>{const e=P(t)._default;return z("div",{class:"bb-progress"},[z("div",{class:"bb-progress-text"},t.content),z("div",{class:"bb-progress-bar",style:`width: calc(${e}% - 6px)`},""),z("div",{class:"bb-progress-bar-other"},"")])},quote:(t,e)=>{const n=P(t,e.data.raw);return"\n"===t.content[0]&&t.content.shift(),[`\n[${t.tag}="${n._default}"]\n\n`,...t.content,"\n\n[/quote]\n"]},...xt,thinprogress:(t,e)=>{const n=P(t,e.data.raw)._default;return z("div",{class:"bb-progress-thin"},[z("div",{class:"bb-progress-text"},t.content),z("div",{class:"bb-progress-bar",style:`width: calc(${n}% - 6px)`},""),z("div",{class:"bb-progress-bar-other"},"")])},savenl:t=>({isWhitespaceSensitive:!0,content:t.content}),sh:t=>z("h2",{},t.content),script:(t,e)=>{const n=P(t,e.data.raw);e.data.previewing||e.data.commonGUID||(e.data.commonGUID="post-"+Math.random().toString(36).substring(2,7));const s=e.data.previewing?"preview":e.data.commonGUID,r=$t.includes(n.on?.toLowerCase()||"init")&&n.on?.toLowerCase()||"init",o={id:s,class:n.class||"",on:r,version:n.version||"",content:t.content.join("")};return e.data.bbscripts.push(o),[]},scroll:(t,e)=>{const n=function(t){const e=t&&""!==t.trim()?t.replace(/[^\d.]/g,""):0;return e&&e>=0&&e<=700?e:0===e?0:700}(P(t,e.data.raw)._default);return z("div",{class:"bb-scroll",style:`height: ${n}px`},t.content)},side:t=>{const e=P(t)._default||"left";return z("div",{class:"bb-side","data-side":e},t.content)},size:t=>{const e=function(t){let e,n={valid:!0};const s=/(\d+\.?\d?)(px|rem)?/i.exec(t),r=36,o=8,a=3,i=.2,c=7,l=1;if(s&&(e=s[1])){switch(n.unit=(s[2]||"").toLowerCase(),n.unit){case"px":e>r?e=r:e<o&&(e=o);break;case"rem":e>a?e=a:e<i&&(e=i);break;default:(n.valid=t.length===e.length)&&(e>c?e=c:e<l&&(e=l))}n.value=e}return n}(P(t)._default);if(!e.valid)return t.content;let n={};return n=e.unit?{style:`font-size: ${e.value}${e.unit}`}:{"data-size":e.value},z("span",n,t.content)},spoiler:(t,e)=>{const n=P(t,e.data.raw)._default;return z("details",{class:"bb-spoiler"},[z("summary",{},"Spoiler"+(n?`: ${n}`:"")),z("div",{class:"bb-spoiler-content"},t.content)])},sub:t=>z("sub",{},t.content),sup:t=>z("sup",{},t.content),tab:(t,e)=>{if(!t.isValid)return[M(t,e.data.raw),...t.content,F(t,e.data.raw)];const n=P(t,e.data.raw),s=n._default||n.name||"Tab",r=`tab-${s.replace(/\W/g,"_")}-${X()}`;return[z("input",{type:"radio",id:r,name:"tab-group-"+t.groupId,class:"bb-tab",checked:t.open}),z("label",{class:"bb-tab-label",for:r,style:n.style},s),z("div",{class:"bb-tab-content"},t.content)]},tabs:(t,e)=>{const n=t.content.filter((t=>u(t)&&"tab"===t.tag)),s=X();return n.forEach((t=>{t.isValid=!0,t.groupId=s})),n.length?(n[0].open=!0,z("div",{class:"bb-tabs"},n)):[M(t,e.data.raw),...t.content,F(t,e.data.raw)]},...Tt,b:t=>z("span",{class:"bbcode-b"},t.content),i:t=>t.gen?t:z("span",{class:"bbcode-i"},t.content),u:t=>z("span",{class:"bbcode-u"},t.content),s:t=>z("span",{class:"bbcode-s"},t.content)},Ct=Object.keys(At),St=function t(e,n=at){const s=t=>{function r(t,r){return n(e,t,r,s.options||{})}return s.options=Object.assign(s.options||{},t),r.options=s.options,r};return s.extend=function(r){return t(r(e,s.options),n)},s}(At);function _t(t){return t.replaceAll(R,"").replaceAll(J,"").replaceAll("\n"+Z,"").replaceAll(Z+"\n","").replaceAll(Z,"")}function jt(t){return t.replaceAll("</ol>\n<br><ol>","").replaceAll("</ul>\n<br><ul>","").replaceAll("</blockquote>\n<blockquote>","")}function Lt(t,e){const n=e.hoistMap;for(const[e,s]of Object.entries(n))t=t.replaceAll(e,s);return t}function Ot(t,e){if(0===e.styles.length)return t;return'<template data-bbcode-plus="class">'+e.styles.join("\n")+"</template>"+t}function Et(t,e){if(0===e.bbscripts.length)return t;return e.bbscripts.map((t=>`<template data-bbcode-plus="script" data-bbscript-id="${t.id}" data-bbscript-class="${t.class}" data-bbscript-on="${t.on}" data-bbscript-ver="${t.version}">${t.content}</template>`)).join("")+t}function Nt(t,e){const n={};let s=0;const r=(e,s,r,o=!1)=>{const a=X();return-1!==s?(n[a]=t.substring(e,s),t=t.substring(0,e)+a+t.substring(s)):(n[a]=t.substring(e),t=t.substring(0,e)+a+r),o&&(n[a].startsWith("\n")&&(n[a]=n[a].substring(1)),n[a].endsWith("\n")&&(n[a]=n[a].substring(0,n[a].length-1))),e+a.length+r.length};for(;-1!==(s=B(t,K,s));){const e=K.exec(t.substring(s));if(e.groups?.fence){const r=e.groups.fence,o=e.groups.fenceInfo;"\n"===t[s]&&(s+=1);const a=new RegExp("\n"+r+"(\n|$)"),i=B(t,a,s+r.length),c=X();n[c]=-1!==i?t.substring(s+r.length+o.length,i):t.substring(s+r.length+o.length);const l=`[saveNL]\n${r}${o}${c}\n${r}\n[/saveNL]`;t=t.substring(0,s)+l+(-1!==i?t.substring(i+1+r.length):""),s+=l.length}else if(e.groups?.bbcode){const n=e.groups.bbcode,o=`[/${e.groups.bbcodeTag.toLowerCase()}]`,a=t.toLowerCase().indexOf(o,s+1);s=r(s+n.length,a,o,!0)}else if(e.groups.backtick){const t=e.groups.backtick,n=e.groups.tickStart,o=e.groups.tickEnd;s=r(s+n.length,s+t.length-o.length,o)}}return e.hoistMap=n,[t,e]}function Wt(t,e){let n=0;for(;-1!==(n=B(t,Q,n));){const e=Q.exec(t.substring(n))[0],s=`[saveNL]\n${e}\n[/saveNL]`;t=t.substring(0,n)+s+t.substring(n+e.length),n+=s.length}return[t,e]}const It={onlyAllowTags:[...Ct],caseFreeTags:!0,contextFreeTags:["plain","code","icode","class","fa"],enableEscapeTags:!0,onError:t=>{It.previewing&&console.warn(t.message,t.lineNumber,t.columnNumber)}},Ut=St();t.RpNBBCode=(t,e)=>{const n=[Ut];e.preserveWhitespace&&n.push((t=>st(t))),n.push((t=>et(t)),ot);const[s,r]=function(t){let e={};const n=[Nt,Wt];for(const s of n)[t,e]=s(t,e);return[t,e]}(t);return function(t){const e="function"==typeof t?[t]:t||[],n=()=>"";return{process(t,s){const r=s||{skipParse:!1,parser:W,render:n,data:null},o=r.parser||W,a=r.render,i=r.data||null;if("function"!=typeof o)throw new Error("C1");const c=r.skipParse&&Array.isArray(t)?t:o(t,r);let l=r.skipParse&&Array.isArray(t)?q(t||[],r):q(c,r);for(let t=0;t<e.length;t++){const n=e[t];if("function"==typeof n&&a){const t=n(l,{parse:o,render:a,iterate:U,data:i});l=q(t||l,r)}}return{get html(){if("function"!=typeof a)throw new Error("C2");return a(l,l.options)},tree:l,raw:c,messages:l.messages}}}}(n).process(s,{render:G,...It,data:{...r,raw:s,previewing:e.previewing,fonts:new Set,styles:[],bbscripts:[]}})},t.postprocess=function(t,e){let n=t;const s=[_t,Ot,Et,jt,Lt];for(const t of s)n=t(n,e);return n}}));
//# sourceMappingURL=bbcode-parser.min.js.map
